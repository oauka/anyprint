
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>애니프린트 (AnyPrint)</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.6.0/fabric.min.js" defer></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: sans-serif; margin: 0; background: #f0f0f0; }
    .toolbar {
      background: #fff;
      padding: 12px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      border-bottom: 2px solid #ccc;
    }
    .toolbar label, .toolbar select, .toolbar button, .toolbar input {
      font-size: 16px;
    }
    canvas {
      border: 1px solid #888;
      background: #fff;
      display: block;
      margin: 20px auto;
    }
  </style>
</head>
<body>
  <div class="toolbar">
    <label>배경:</label><input type="color" id="bgColor" value="#ffffff" />
    <label>글자색:</label><input type="color" id="fontColor" value="#000000" />
    <label>크기:</label><select id="fontSize"></select>
    <button onclick="addText()">텍스트 추가</button>
    <input type="file" id="imageUpload" />
    <button onclick="download()">저장</button>
  </div>

  <canvas id="canvas" width="1087" height="614"></canvas>

  <script defer>
    window.addEventListener('DOMContentLoaded', () => {
      const canvas = new fabric.Canvas("canvas");
      const centerX = canvas.getWidth() / 2;

      canvas.setBackgroundColor("#ffffff", canvas.renderAll.bind(canvas));

      // 재단선, 세이프박스 추가
      const trimBox = new fabric.Rect({
        left: (1087 - 1063) / 2,
        top: (614 - 591) / 2,
        width: 1063,
        height: 591,
        stroke: "red",
        strokeWidth: 1,
        fill: "",
        selectable: false,
        evented: false
      });

      const safeBox = new fabric.Rect({
        left: (1087 - 1043) / 2,
        top: (614 - 578) / 2,
        width: 1043,
        height: 578,
        stroke: "rgba(0,0,0,0.3)",
        strokeWidth: 1,
        fill: "",
        selectable: false,
        evented: false
      });

      canvas.add(trimBox, safeBox);

      // 기본 텍스트 추가
      ["홍길동", "대표", "010-1234-5678"].forEach((txt, i) => {
        const t = new fabric.IText(txt, {
          left: centerX,
          top: 150 + i * 50,
          fontSize: 24 - i * 2,
          fill: "#000000",
          textAlign: "center",
          originX: "center"
        });
        canvas.add(t);
      });

      function addText() {
        const t = new fabric.IText("새 텍스트", {
          left: centerX,
          top: 350,
          fontSize: 20,
          fill: "#000000",
          textAlign: "center",
          originX: "center"
        });
        canvas.add(t);
        canvas.setActiveObject(t);
      }

      function download() {
        const a = document.createElement("a");
        a.href = canvas.toDataURL({ format: "png" });
        a.download = "anyprint.png";
        a.click();
      }

      // 배경색 변경
      document.getElementById("bgColor").oninput = (e) => {
        canvas.setBackgroundColor(e.target.value, canvas.renderAll.bind(canvas));
      };

      // 글자색 변경
      document.getElementById("fontColor").oninput = (e) => {
        const obj = canvas.getActiveObject();
        if (obj && obj.type === "i-text") {
          obj.set("fill", e.target.value);
          canvas.renderAll();
        }
      };

      // 글자 크기 설정
      const fontSizeSel = document.getElementById("fontSize");
      for (let i = 6; i <= 72; i++) {
        const opt = document.createElement("option");
        opt.value = i;
        opt.innerText = i + "pt";
        if (i === 20) opt.selected = true;
        fontSizeSel.appendChild(opt);
      }

      fontSizeSel.onchange = (e) => {
        const obj = canvas.getActiveObject();
        if (obj && obj.type === "i-text") {
          obj.set("fontSize", parseInt(e.target.value));
          canvas.renderAll();
        }
      };

      // 이미지 업로드
      document.getElementById("imageUpload").onchange = function (e) {
        const reader = new FileReader();
        reader.onload = function (event) {
          fabric.Image.fromURL(event.target.result, function (img) {
            img.scaleToWidth(200);
            img.set({ left: centerX, top: 400 });
            canvas.add(img);
          });
        };
        reader.readAsDataURL(e.target.files[0]);
      };

      // 전역 함수 연결
      window.addText = addText;
      window.download = download;
    });
  </script>
</body>
</html>
